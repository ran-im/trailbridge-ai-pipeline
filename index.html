<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TrailBridge AI Pipeline</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,400;9..40,500;9..40,600;9..40,700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root { --bg-primary: #0d1117; --bg-secondary: #161b22; --bg-tertiary: #21262d; --text-primary: #f0f6fc; --text-secondary: #8b949e; --text-muted: #6e7681; --accent-teal: #2dd4bf; --accent-teal-dark: #14b8a6; --accent-orange: #f97316; --accent-orange-dark: #ea580c; --border-color: #30363d; --success: #3fb950; --error: #f85149; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'DM Sans', sans-serif; background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; line-height: 1.6; }
    .container { max-width: 1200px; margin: 0 auto; padding: 2rem; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; padding-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); }
    .logo { display: flex; align-items: center; gap: 0.75rem; }
    .logo-icon { width: 40px; height: 40px; background: linear-gradient(135deg, var(--accent-teal), var(--accent-orange)); border-radius: 10px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 1.25rem; }
    .logo h1 { font-size: 1.5rem; font-weight: 700; background: linear-gradient(90deg, var(--accent-teal), var(--accent-orange)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; }
    .header-actions { display: flex; gap: 1rem; align-items: center; }
    .btn { padding: 0.625rem 1.25rem; border-radius: 8px; font-weight: 600; font-size: 0.875rem; cursor: pointer; transition: all 0.2s ease; border: none; font-family: inherit; }
    .btn-primary { background: var(--accent-teal); color: var(--bg-primary); }
    .btn-primary:hover { background: var(--accent-teal-dark); transform: translateY(-1px); }
    .btn-secondary { background: var(--bg-tertiary); color: var(--text-primary); border: 1px solid var(--border-color); }
    .btn-secondary:hover { background: var(--border-color); }
    .btn-orange { background: var(--accent-orange); color: white; }
    .btn-orange:hover { background: var(--accent-orange-dark); }
    .api-key-panel { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; }
    .api-key-panel h3 { font-size: 1rem; margin-bottom: 1rem; }
    .api-key-input-group { display: flex; gap: 0.75rem; }
    .api-key-input-group input { flex: 1; padding: 0.75rem 1rem; border-radius: 8px; border: 1px solid var(--border-color); background: var(--bg-primary); color: var(--text-primary); font-family: 'JetBrains Mono', monospace; font-size: 0.875rem; }
    .api-key-input-group input:focus { outline: none; border-color: var(--accent-teal); }
    .api-key-note { font-size: 0.75rem; color: var(--text-muted); margin-top: 0.75rem; }
    #key-status { font-size: 0.875rem; margin-top: 0.75rem; min-height: 1.5em; }
    .status-bar { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; margin-bottom: 2rem; }
    .status-bar h2 { font-size: 1.125rem; margin-bottom: 1rem; }
    .progress-stages { display: flex; gap: 0.5rem; margin-bottom: 1rem; }
    .progress-stage { flex: 1; padding: 0.75rem; border-radius: 8px; background: var(--bg-tertiary); text-align: center; font-size: 0.8125rem; color: var(--text-muted); transition: all 0.3s ease; }
    .progress-stage.active { background: var(--accent-teal); color: var(--bg-primary); font-weight: 600; }
    .progress-stage.complete { background: var(--success); color: var(--bg-primary); }
    .progress-bar-container { height: 8px; background: var(--bg-tertiary); border-radius: 4px; overflow: hidden; }
    .progress-bar { height: 100%; background: linear-gradient(90deg, var(--accent-teal), var(--accent-orange)); border-radius: 4px; transition: width 0.5s ease; width: 0%; }
    .status-message { margin-top: 1rem; font-size: 0.875rem; color: var(--text-secondary); }
    .tabs { display: flex; gap: 0.25rem; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-color); padding-bottom: 0; }
    .tab { padding: 0.875rem 1.5rem; background: transparent; border: none; color: var(--text-secondary); font-weight: 500; cursor: pointer; position: relative; transition: all 0.2s ease; font-family: inherit; font-size: 0.9375rem; }
    .tab:hover { color: var(--text-primary); }
    .tab.active { color: var(--accent-teal); }
    .tab.active::after { content: ''; position: absolute; bottom: -1px; left: 0; right: 0; height: 2px; background: var(--accent-teal); }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
    .card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 1rem; }
    .card h3 { font-size: 1rem; color: var(--accent-teal); }
    .badge { padding: 0.25rem 0.625rem; border-radius: 20px; font-size: 0.75rem; font-weight: 600; }
    .badge-high { background: rgba(63, 185, 80, 0.2); color: var(--success); }
    .badge-medium { background: rgba(249, 115, 22, 0.2); color: var(--accent-orange); }
    .badge-low { background: rgba(248, 81, 73, 0.2); color: var(--error); }
    .stat-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; margin-bottom: 2rem; }
    .stat-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; padding: 1.25rem; text-align: center; }
    .stat-value { font-size: 1.75rem; font-weight: 700; color: var(--accent-teal); }
    .stat-label { font-size: 0.8125rem; color: var(--text-secondary); margin-top: 0.25rem; }
    .persona-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 1rem; }
    .persona-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; }
    .persona-card h4 { font-size: 1.125rem; margin-bottom: 0.75rem; color: var(--accent-orange); }
    .persona-characteristics { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-bottom: 1rem; }
    .characteristic-tag { background: var(--bg-tertiary); padding: 0.25rem 0.625rem; border-radius: 6px; font-size: 0.8125rem; color: var(--text-secondary); }
    .funnel-list { list-style: none; }
    .funnel-item { background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; margin-bottom: 0.75rem; }
    .funnel-stage { font-weight: 600; color: var(--accent-teal); margin-bottom: 0.25rem; }
    .funnel-percentage { font-size: 0.875rem; color: var(--text-secondary); }
    .strategy-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; margin-bottom: 1rem; }
    .strategy-section { margin-bottom: 1rem; }
    .strategy-section:last-child { margin-bottom: 0; }
    .strategy-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 0.5rem; }
    .strategy-content { background: var(--bg-tertiary); padding: 1rem; border-radius: 8px; }
    .campaign-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1rem; }
    .campaign-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 1.5rem; }
    .campaign-card h4 { font-size: 1rem; color: var(--accent-orange); margin-bottom: 1rem; }
    .campaign-item { margin-bottom: 1rem; }
    .campaign-item:last-child { margin-bottom: 0; }
    .campaign-label { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 0.05em; color: var(--text-muted); margin-bottom: 0.25rem; }
    .campaign-content { background: var(--bg-tertiary); padding: 0.75rem; border-radius: 6px; font-size: 0.875rem; }
    .confidence-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem; }
    .confidence-card { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 10px; padding: 1.25rem; text-align: center; }
    .confidence-score { font-size: 2.5rem; font-weight: 700; }
    .confidence-label { font-size: 0.875rem; color: var(--text-secondary); margin-top: 0.25rem; }
    .revenue-calculator { background: var(--bg-secondary); border: 1px solid var(--border-color); border-radius: 12px; padding: 2rem; margin-top: 2rem; }
    .revenue-calculator h3 { margin-bottom: 1.5rem; color: var(--accent-orange); }
    .slider-container { margin-bottom: 1.5rem; }
    .slider-label { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.875rem; }
    .slider { width: 100%; height: 8px; border-radius: 4px; background: var(--bg-tertiary); -webkit-appearance: none; appearance: none; }
    .slider::-webkit-slider-thumb { -webkit-appearance: none; width: 20px; height: 20px; border-radius: 50%; background: var(--accent-orange); cursor: pointer; }
    .revenue-result { display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-top: 1.5rem; }
    .revenue-item { text-align: center; padding: 1rem; background: var(--bg-tertiary); border-radius: 8px; }
    .revenue-value { font-size: 1.5rem; font-weight: 700; color: var(--accent-teal); }
    .revenue-label { font-size: 0.75rem; color: var(--text-secondary); margin-top: 0.25rem; }
    .welcome-message { text-align: center; padding: 4rem 2rem; }
    .welcome-message h2 { font-size: 2rem; margin-bottom: 1rem; }
    .welcome-message p { color: var(--text-secondary); max-width: 500px; margin: 0 auto; }
    .hidden { display: none !important; }
    .error-message { background: rgba(248, 81, 73, 0.1); border: 1px solid var(--error); color: var(--error); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
    .recommendations-list { list-style: none; }
    .recommendations-list li { background: var(--bg-tertiary); padding: 0.75rem 1rem; border-radius: 6px; margin-bottom: 0.5rem; font-size: 0.875rem; }
    @media print { body { background: white; color: black; } .api-key-panel, .header-actions, .tabs, .status-bar, .revenue-calculator { display: none !important; } .card, .persona-card, .strategy-card, .campaign-card { background: white; border: 1px solid #ddd; break-inside: avoid; } }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="logo"><div class="logo-icon">TB</div><h1>TrailBridge AI Pipeline</h1></div>
      <div class="header-actions"><button class="btn btn-secondary" id="exportBtn" disabled>Export PDF</button><button class="btn btn-orange" id="runBtn">Run Pipeline</button></div>
    </header>
    <div class="api-key-panel"><h3>Anthropic API Key</h3><div class="api-key-input-group"><input type="password" id="api-key-input" placeholder="sk-ant-api03-..."><button class="btn btn-primary" id="save-key-btn" onclick="console.log('clicked'); document.dispatchEvent(new CustomEvent('save-key-click'))">Save Key</button></div><p id="key-status"></p><p class="api-key-note">Your API key is stored in sessionStorage only and never leaves your browser.</p></div>
    <div class="status-bar"><h2>Pipeline Progress</h2><div class="progress-stages"><div class="progress-stage" id="stageData">Data</div><div class="progress-stage" id="stageScout">Scout</div><div class="progress-stage" id="stageCompass">Compass</div><div class="progress-stage" id="stageTrailhead">Trailhead</div><div class="progress-stage" id="stageEvaluator">Evaluator</div></div><div class="progress-bar-container"><div class="progress-bar" id="progressBar"></div></div><p class="status-message" id="statusMessage">Ready to run pipeline</p></div>
    <div class="tabs"><button class="tab active" data-tab="overview">Overview</button><button class="tab" data-tab="personas">Personas</button><button class="tab" data-tab="strategies">Strategies</button><button class="tab" data-tab="campaigns">Campaigns</button><button class="tab" data-tab="confidence">Confidence</button></div>
    <div id="tabOverview" class="tab-content active"><div class="welcome-message"><h2>Welcome to TrailBridge AI Pipeline</h2><p>Click "Run Pipeline" to generate personas, strategies, and campaign content using AI agents.</p></div></div>
    <div id="tabPersonas" class="tab-content"></div>
    <div id="tabStrategies" class="tab-content"></div>
    <div id="tabCampaigns" class="tab-content"></div>
    <div id="tabConfidence" class="tab-content"></div>
    <div class="revenue-calculator"><h3>Recovery Revenue Calculator</h3><div class="slider-container"><div class="slider-label"><span>Recovery Rate</span><span id="recoveryRateValue">25%</span></div><input type="range" class="slider" id="recoverySlider" min="5" max="50" value="25"></div><div class="revenue-result"><div class="revenue-item"><div class="revenue-value" id="currentLoss">€0</div><div class="revenue-label">Current Monthly Loss</div></div><div class="revenue-item"><div class="revenue-value" id="recoveryAmount">€0</div><div class="revenue-label">Recoverable</div></div><div class="revenue-item"><div class="revenue-value" id="annualGain">€0</div><div class="revenue-label">Annual Gain</div></div></div></div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('save-key-btn').addEventListener('click', function() {
        var key = document.getElementById('api-key-input').value.trim();
        if (!key) {
          document.getElementById('key-status').textContent = 'Please enter a key';
          return;
        }
        sessionStorage.setItem('anthropic_api_key', key);
        document.getElementById('key-status').textContent = 'Key saved!';
        document.getElementById('api-key-input').value = '';
      });
    });
  </script>
  <script type="module" src="js/data.js"></script>
  <script type="module" src="js/agents.js"></script>
  <script type="module" src="js/pipeline.js"></script>
  <script type="module" src="js/ui.js"></script>
</body>
</html>
